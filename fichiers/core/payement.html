{% extends 'core/base.html' %}

{% load static %}

{% block title %}Paiement de la demande{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Paiement de votre demande d'acte</h4>
                </div>
                <div class="card-body">
                    <!-- Résumé de la commande -->
                    <div class="mb-4">
                        <h5 class="card-title border-bottom pb-2">Résumé de la demande</h5>
                        <div class="row mb-2">
                            <div class="col-md-4 fw-bold">Référence:</div>
                            <div class="col-md-8">{{ demande.reference }}</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-4 fw-bold">Type d'acte:</div>
                            <div class="col-md-8">{{ demande.type_acte }}</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-4 fw-bold">Demandeur:</div>
                            <div class="col-md-8">{{ demande.user.get_full_name }}</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-4 fw-bold">Date de la demande:</div>
                            <div class="col-md-8">{{ demande.date_demande|date:"d/m/Y" }}</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-4 fw-bold">Montant à payer:</div>
                            <div class="col-md-8 fw-bold text-primary">{{ demande.montant }} FCFA</div>
                        </div>
                    </div>

                    <!-- Options de paiement -->
                    <form method="post" action="{% url 'core:process_payment' demande.id %}">
                        {% csrf_token %}
                        <h5 class="card-title border-bottom pb-2">Mode de paiement</h5>
                        
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="payment-methods">
                                    <!-- Options de paiement mobile -->
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="payment_method" id="orange_money" value="orange_money" required>
                                        <label class="form-check-label d-flex align-items-center" for="orange_money">
                                            <img src="{% static 'img/orange_money.png' %}" alt="Orange Money" height="30" class="me-2">
                                            Orange Money
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="payment_method" id="mtn_momo" value="mtn_momo">
                                        <label class="form-check-label d-flex align-items-center" for="mtn_momo">
                                            <img src="{% static 'img/mtn_momo.png' %}" alt="MTN Mobile Money" height="30" class="me-2">
                                            MTN Mobile Money
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="payment_method" id="moov_flooz" value="moov_flooz">
                                        <label class="form-check-label d-flex align-items-center" for="moov_flooz">
                                            <img src="{% static 'img/moov_flooz.png' %}" alt="Moov Flooz" height="30" class="me-2">
                                            Moov Flooz
                                        </label>
                                    </div>
                                    
                                    <!-- Option carte bancaire -->
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="payment_method" id="card_payment" value="card_payment">
                                        <label class="form-check-label d-flex align-items-center" for="card_payment">
                                            <img src="{% static 'img/cards.png' %}" alt="Carte bancaire" height="30" class="me-2">
                                            Carte bancaire (Visa/Mastercard)
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Détails supplémentaires selon mode de paiement -->
                        <div class="payment-details mb-4">
                            <!-- Orange Money (visible si sélectionné) -->
                            <div class="orange-money-details d-none payment-specific-details">
                                <div class="mb-3">
                                    <label for="phone_number" class="form-label">Numéro Orange Money</label>
                                    <div class="input-group">
                                        <span class="input-group-text">+</span>
                                        <input type="text" class="form-control" id="phone_number" name="phone_number" placeholder="22501234567">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- MTN MoMo (visible si sélectionné) -->
                            <div class="mtn-momo-details d-none payment-specific-details">
                                <div class="mb-3">
                                    <label for="mtn_number" class="form-label">Numéro MTN MoMo</label>
                                    <div class="input-group">
                                        <span class="input-group-text">+</span>
                                        <input type="text" class="form-control" id="mtn_number" name="mtn_number" placeholder="22507654321">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Moov Flooz (visible si sélectionné) -->
                            <div class="moov-flooz-details d-none payment-specific-details">
                                <div class="mb-3">
                                    <label for="moov_number" class="form-label">Numéro Moov Flooz</label>
                                    <div class="input-group">
                                        <span class="input-group-text">+</span>
                                        <input type="text" class="form-control" id="moov_number" name="moov_number" placeholder="22509876543">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Carte bancaire (visible si sélectionné) -->
                            <div class="card-payment-details d-none payment-specific-details">
                                <div class="mb-3">
                                    <label for="card_number" class="form-label">Numéro de carte</label>
                                    <input type="text" class="form-control" id="card_number" name="card_number" placeholder="1234 5678 9012 3456">
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="expiry_date" class="form-label">Date d'expiration</label>
                                        <input type="text" class="form-control" id="expiry_date" name="expiry_date" placeholder="MM/AA">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="cvv" class="form-label">CVV</label>
                                        <input type="text" class="form-control" id="cvv" name="cvv" placeholder="123">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="card_holder" class="form-label">Nom du titulaire</label>
                                    <input type="text" class="form-control" id="card_holder" name="card_holder" placeholder="JEAN DUPONT">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Conditions et bouton de paiement -->
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="terms_accepted" name="terms_accepted" required>
                            <label class="form-check-label" for="terms_accepted">
                                J'accepte les <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">conditions générales</a> et la politique de confidentialité
                            </label>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">Procéder au paiement</button>
                            <a href="{% url 'core:demande_detail' demande.id %}" class="btn btn-outline-secondary">Annuler</a>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Informations de sécurité -->
            <div class="card mt-4">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <i class="bi bi-shield-lock fs-2 me-3 text-success"></i>
                        <div>
                            <h5 class="mb-0">Paiement sécurisé</h5>
                            <p class="mb-0 text-muted">Toutes vos données sont cryptées et sécurisées</p>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-question-circle fs-2 me-3 text-primary"></i>
                        <div>
                            <h5 class="mb-0">Besoin d'aide?</h5>
                            <p class="mb-0 text-muted">Contactez notre service client au <strong>+225 07 XX XX XX</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal pour les conditions générales -->
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="termsModalLabel">Conditions générales de service</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>1. Conditions de paiement</h6>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam auctor, nisl eget ultricies tincidunt, nisl nisl aliquam nisl, eget ultricies nisl nisl eget nisl.</p>
                
                <h6>2. Sécurité des transactions</h6>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam auctor, nisl eget ultricies tincidunt, nisl nisl aliquam nisl, eget ultricies nisl nisl eget nisl.</p>
                
                <h6>3. Protection des données personnelles</h6>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam auctor, nisl eget ultricies tincidunt, nisl nisl aliquam nisl, eget ultricies nisl nisl eget nisl.</p>
                
                <h6>4. Remboursements et annulations</h6>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam auctor, nisl eget ultricies tincidunt, nisl nisl aliquam nisl, eget ultricies nisl nisl eget nisl.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Script pour afficher les champs spécifiques selon le mode de paiement sélectionné
    document.addEventListener('DOMContentLoaded', function() {
        const paymentMethods = document.querySelectorAll('input[name="payment_method"]');
        const detailsContainers = document.querySelectorAll('.payment-specific-details');
        
        // Fonction pour afficher les détails appropriés
        function showPaymentDetails() {
            // Cacher tous les conteneurs de détails
            detailsContainers.forEach(container => {
                container.classList.add('d-none');
            });
            
            // Afficher le conteneur correspondant à l'option sélectionnée
            let selectedMethod = document.querySelector('input[name="payment_method"]:checked');
            if (selectedMethod) {
                switch (selectedMethod.value) {
                    case 'orange_money':
                        document.querySelector('.orange-money-details').classList.remove('d-none');
                        break;
                    case 'mtn_momo':
                        document.querySelector('.mtn-momo-details').classList.remove('d-none');
                        break;
                    case 'moov_flooz':
                        document.querySelector('.moov-flooz-details').classList.remove('d-none');
                        break;
                    case 'card_payment':
                        document.querySelector('.card-payment-details').classList.remove('d-none');
                        break;
                }
            }
        }
        
        // Ajouter des écouteurs d'événements
        paymentMethods.forEach(method => {
            method.addEventListener('change', showPaymentDetails);
        });
        
        // Initialiser l'affichage
        showPaymentDetails();
    });
</script>
{% endblock %}